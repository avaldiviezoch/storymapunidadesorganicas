<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>La Aventura ‚Äî Regalo interactivo</title>

  <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inconsolata:wght@300;400;700;900&display=swap" rel="stylesheet">

  <style>
    /* ===== Variables responsivas ===== */
    :root{
      --wallX: 40px;           /* margen paredes laterales (zona libre) */
      --wallTop: 60px;         /* techo libre */
      --wallBottom: 85px;      /* suelo libre */
      --heroSize: clamp(76px, 12vw, 110px);
      --chestSize: clamp(68px, 10vw, 100px);
      --dialogFS: clamp(18px, 3.8vw, 22px);
      --btnFS: clamp(18px, 3.8vw, 25px);
    }

    html,body{height:100%}
    body{
      margin:0; background:#111; color:#f9f9f9;
      font-family: Inconsolata, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
      touch-action: manipulation; /* reduce zoom doble tap */
    }
    a{ text-decoration:none; color:#f9f9f9 }
    #out-all{
      position:fixed; inset:0; display:flex; align-items:center; justify-content:center; padding:16px;
    }

    /* ===== Pantallas marco ===== */
    .frame{
      position:absolute; width:min(720px, 96vw); min-height:300px; max-height:86vh;
      display:none; align-items:center; justify-content:center; flex-direction:column;
      background:#111; box-shadow:0 10px 40px rgba(0,0,0,.4); border-radius:12px; padding:20px;
      text-align:center; gap:8px;
    }
    #f1{display:flex}

    .decidir{display:flex; align-items:center; justify-content:center; flex-wrap:wrap; gap:8px}
    .btn{
      font:var(--btnFS) 'VT323', monospace; margin:10px; opacity:0; animation:visible .9s .3s forwards;
      cursor:pointer; color:#f9f9f9; padding:10px 16px; border-radius:10px; border:1px dashed rgba(255,255,255,.18);
      user-select:none;
    }
    .btn:focus{ outline:2px dashed #72efff; outline-offset:2px }

    h1,h2,h3{margin:6px 10px}
    h1{
      overflow:hidden; border-right:.15em solid #fff; white-space:nowrap; letter-spacing:.03em;
      animation: typing 2.6s steps(38,end), blink-caret .75s step-end infinite;
      font: clamp(22px, 5vw, 30px) 'VT323', monospace;
    }
    h2,h3{font: clamp(20px, 4.5vw, 26px) 'VT323', monospace}

    /* ===== Mundo (cueva retro) ===== */
    #f7{
      position:absolute; width:min(900px, 98vw); height:min(620px, 90vh);
      background:url(https://i.imgur.com/kx3psEN.png) center/cover no-repeat;
      display:none; align-items:center; justify-content:center; flex-direction:column;
      border-radius:14px; box-shadow:0 20px 60px rgba(0,0,0,.45);
      overflow:hidden;
    }

    /* Di√°logos en cajas (no salen de paredes) */
    .dialogBox{ position:absolute; left:var(--wallX); right:var(--wallX); display:none; }
    #f8, #f9 { bottom: clamp(90px, 16vh, 150px); }
    #f11      { top: clamp(70px, 12vh, 120px); }
    .dialogInner{
      margin:0 auto;
      max-width:min(620px, calc(100% - 12px));
      background:rgba(0,0,0,.75);
      border:1px solid rgba(255,255,255,.18);
      border-radius:12px; padding:12px 14px;
      box-shadow:0 10px 30px rgba(0,0,0,.35);
      font:var(--dialogFS) 'VT323', monospace; line-height:1.35;
      white-space:normal; word-break:break-word; text-align:center;
    }
    .dialogInner p{ margin:.25em 0; }

    /* Zona de cofres */
    #f10{
      position:absolute; bottom: clamp(70px, 15vh, 140px);
      left:var(--wallX); right:var(--wallX);
      display:none; align-items:center; justify-content:center; gap: clamp(12px, 3.5vw, 22px);
    }
    .box{
      width:var(--chestSize); height:var(--chestSize);
      background:url(https://i.imgur.com/ViqP2fB.png) center/cover no-repeat;
      cursor:pointer; transition:transform .12s ease; flex:0 0 auto;
      image-rendering: pixelated;
    }
    .box.wiggle{ animation: wiggle .45s ease-in-out infinite; }
    .box.opened{ background:url(https://i.imgur.com/FIrcwmM.png) center/cover no-repeat; transform:translateY(-2px); }

    /* Pantallas internas */
    #f12,#f18{position:absolute; inset:0; background:#111; display:none; align-items:center; justify-content:center; flex-direction:column;}
    #f13{display:none; text-align:center}
    #f13 a{display:inline-block; margin-top:10px}
    #f14,#f15{background:#111; position:absolute; inset:0; font: clamp(18px, 4vw, 26px) 'VT323', monospace; text-align:justify; display:none; padding:clamp(16px, 4vw, 28px); line-height:1.35;}
    #f16,#f17{position:absolute; inset:0; display:none; align-items:center; justify-content:center; flex-direction:column; gap:12px}
    .ring{width: clamp(110px, 18vw, 150px); height: clamp(110px, 18vw, 150px); background:url(https://i.imgur.com/oEs8TdL.png) center/cover no-repeat}
    .ichigo{width: clamp(140px, 22vw, 200px); height: clamp(140px, 22vw, 200px); background:url(https://i.imgur.com/hGY3pGX.png) center/cover no-repeat}
    #f19,#f20,#f21,#f22{position:absolute; inset:0; background:#111; display:none; align-items:center; justify-content:center; flex-direction:column; text-align:center; padding:24px;}
    #f22{font: clamp(18px, 4vw, 26px) 'VT323', monospace; text-align:justify}

    /* Avatar presentaci√≥n (f6) */
    .img1{
      width: clamp(90px, 14vw, 120px); height: clamp(90px, 14vw, 120px);
      background:url(https://lh3.googleusercontent.com/d/1IWFy6CLWeEFBnuv1do-p9O2xiO8mP8na=w1000) center/contain no-repeat;
      margin-bottom:8px; border-radius:14px; padding:6px;
      background-color:rgba(255,255,255,.02);
      outline:1px solid rgba(255,255,255,.08);
      box-shadow:0 6px 18px rgba(0,0,0,.25);
      image-rendering: pixelated;
    }

    /* ===== H√©roe movible ===== */
    #hero{
      position:absolute; width:var(--heroSize); height:var(--heroSize);
      pointer-events:none; z-index:20;
      background-position:center; background-repeat:no-repeat; background-size:contain;
      border-radius:16px; padding:6px;
      background-color:rgba(0,0,0,.18);
      outline:1px solid rgba(255,255,255,.07);
      box-shadow:0 10px 28px rgba(0,0,0,.35);
      image-rendering: pixelated;
      transform: translate(-50%, -50%);
      left:50%; top:50%;
    }
    .dir-up    { background-image:url(https://lh3.googleusercontent.com/d/1mSX8bhUoXpRKsKlufh9bKKX2JsckTxvP=w1000); } /* ESPALDAS */
    .dir-down  { background-image:url(https://lh3.googleusercontent.com/d/1IWFy6CLWeEFBnuv1do-p9O2xiO8mP8na=w1000); } /* FRENTE  */
    .dir-left  { background-image:url(https://lh3.googleusercontent.com/d/1_uQuJXLlecsnZnjiRlsgdgf9PrfJoJS_=w1000); } /* IZQ     */
    .dir-right { background-image:url(https://lh3.googleusercontent.com/d/1m0lnXiIshE7uJE1sGA5HkdkcnZR01nIc=w1000); } /* DER     */

    /* Hint del mago (cerca de cofres) */
    #wizardHint{ position:absolute; left:var(--wallX); right:var(--wallX); top:var(--wallTop); display:none; z-index:50; }
    #wizardHint .dialogInner{ margin:0 auto; }

    /* Confirmador */
    #confirm{
      position:fixed; inset:0; background:rgba(0,0,0,.55); display:none; align-items:center; justify-content:center; z-index:9998;
    }
    #confirm .panel{
      background:#111; border:1px solid rgba(255,255,255,.2); border-radius:12px; padding:16px 18px;
      font: clamp(18px, 4vw, 22px) 'VT323', monospace; text-align:center; width:min(420px, 92vw);
      box-shadow:0 20px 60px rgba(0,0,0,.5);
    }
    #confirm .actions{ margin-top:12px; display:flex; gap:12px; justify-content:center; }
    #confirm .actions .btn{ opacity:1; }

    /* Bot√≥n audio */
    #audioToggle{
      position:fixed; right:12px; bottom:12px; z-index:9999;
      font: clamp(16px, 3.8vw, 18px) 'VT323', monospace; padding:8px 12px; border-radius:10px;
      background:#1d1d1d; color:#fff; border:1px solid rgba(255,255,255,.15);
      cursor:pointer; user-select:none;
    }

    /* Animaciones */
    @keyframes typing{from{width:0} to{width:105%}}
    @keyframes blink-caret{from,to{border-color:transparent} 50%{border-color:#fff}}
    @keyframes visible{from{opacity:0} to{opacity:1}}
    @keyframes wiggle{
      0%,100%{ transform:translateY(0) }
      25%{ transform:translateY(-2px) }
      50%{ transform:translateY(2px) }
      75%{ transform:translateY(-1px) }
    }

    /* ===== Ajustes extra m√≥vil ===== */
    @media (max-width:560px){
      :root{
        --wallX: 20px; --wallTop: 40px; --wallBottom: 70px;
      }
    }
  </style>
</head>
<body>
  <!-- AUDIO GLOBAL -->
  <audio id="bgm" src="https://lh3.googleusercontent.com/d/1CyZVteqNTVDNAjZiUQZxczR4azqBSakX=w1000"
         autoplay loop playsinline></audio>
  <div id="audioToggle">üîä M√∫sica</div>

  <div id="out-all">

    <!-- PREGUNTAS -->
    <div id="f1" class="frame">
      <h1>¬øQuieres saber algo de m√≠?</h1>
      <div class="decidir">
        <div class="btn q1-si">&gt; s√≠</div>
        <div class="btn q1-no">&gt; no</div>
      </div>
    </div>
    <div id="close1" class="frame"><h2>Entiendo, cierra el aplicativo y disculpa las molestias.</h2></div>
    <div id="f2new" class="frame">
      <h3>A veces las parejas pelean, a veces t√∫ te cansas de repetir cosas a tu pareja, pero no significa que no te escuche: solo que hace las cosas diferente‚Ä¶</h3>
      <div class="decidir">
        <div class="btn q2-seguir">&gt; seguir</div>
        <div class="btn q2-no">&gt; no seguir</div>
      </div>
    </div>
    <div id="close2" class="frame"><h2>Entiendo, cierra el aplicativo y disculpa las molestias.</h2></div>
    <div id="f3new" class="frame">
      <h3>Antonio dice que no significa que no te ame; hace todo por ti y te da detalles ‚Äîno siempre en los mismos d√≠as‚Äî y tambi√©n se frustra cuando le dices cosas que no hace.</h3>
      <div class="decidir">
        <div class="btn q3-beso">&gt; darle un beso?</div>
        <div class="btn q3-cocacho">&gt; darle un cocacho</div>
      </div>
    </div>
    <div id="f4new" class="frame">
      <h3>Si no quieres seguir en esta aventura, es entendible, pero √©l se supera cada d√≠a y espera seguir.</h3>
      <div class="decidir">
        <div class="btn q4-seguir">&gt; seguir aventura?</div>
        <div class="btn q4-no">&gt; no seguir aventura</div>
      </div>
    </div>
    <div id="f5new" class="frame"><h3>Antonio recibi√≥ un correo electr√≥nico diciendo que pusiste ‚Äúno seguir aventura‚Äù :(</h3></div>

    <!-- INICIO JUEGO -->
    <div id="f6" class="frame" style="display:none">
      <div class="img1"></div>
      <h3>esta eres t√∫, con tu pelo un poco largo y tu ropa amarilla en tendencia; jugaremos un juego: tienes que escoger algo del poderoso mago.</h3>
      <div class="btn afi">Comenzar !!!</div>
    </div>

    <!-- MUNDO -->
    <div id="f7" aria-label="cueva jugable">
      <!-- Hint cerca de cofres -->
      <div id="wizardHint" class="dialogBox">
        <div class="dialogInner">
          <p>¬øEst√°s segura?</p>
          <p>Dale click al cofre.</p>
        </div>
      </div>

      <!-- H√©roe (empieza ‚Äúafuera‚Äù, pegado a la puerta) -->
      <div id="hero" class="dir-up"></div>

      <!-- Di√°logos del mago -->
      <div id="f8" class="dialogBox">
        <div class="dialogInner">
          <p>Hoooola, Lucero. Soy un poderoso mago‚Ä¶</p>
          <p>Jugaremos a <strong>las cajas escondidas</strong>. Presta atenci√≥n.</p>
        </div>
        <div class="decidir"><div class="btn salu">Hola????</div></div>
      </div>

      <div id="f9" class="dialogBox">
        <div class="dialogInner">
          <p>Aqu√≠ hay <strong>3 cajas</strong>. ¬°Escoge bien porque de eso depender√° tu futuro!</p>
          <p>Wuajajajajaja‚Ä¶</p>
        </div>
        <div class="decidir"><div class="btn copy">Moverme</div></div>
      </div>

      <div id="f10">
        <div class="box ca1" data-target="f12" aria-label="Cofre 1"></div>
        <div class="box ca2" data-target="f18" aria-label="Cofre 2"></div>
        <div class="box ca3" data-target="f15" aria-label="Cofre 3"></div>
      </div>

      <div id="f11" class="dialogBox">
        <div class="dialogInner"><p>¬°Escoge con sabidur√≠a!</p></div>
      </div>
    </div>

    <!-- Cofre 1 (carta) -->
    <div id="f12">
      <div id="f13">
        <h1>por favor, reproduce esta canci√≥n antes de leer</h1>
        <a href="https://open.spotify.com/track/6EBPGW7GqFlGYAY1fSXwjI?si=5spKltg4SJu6NXFOkXVvMw" target="_blank" rel="noopener noreferrer">&gt; reproduces la canci√≥n.</a>
        <br/>
        <span class="btn go">&gt; seguir leyendo.</span>
      </div>

      <div id="f14">
        Si alguien me hubiera preguntado siete meses atr√°s si cre√≠a volver a darme la oportunidad...
        <br><br>
        <div class="btn carta">&gt; vuelves a abrir las otras cajas.</div>
      </div>
    </div>

    <!-- Cofre 3 (anillos) -->
    <div id="f15">
      <div id="f16">
        <h3>¬°Oh, mira, ves algo brillante ah√≠ al centro!</h3>
        <h2>Deber√≠as tomarlo...</h2>
        <div class="btn anillo">&gt; lo recoges.</div>
      </div>

      <div id="f17">
        <div class="ring"></div>
        <div class="ichigo"></div>
        <h3>¬°has encontrado los anillos!, pero... ¬øpara qu√© se supone que son?</h3>
        <h2>¬øquieres llev√°rtelos?</h2>
        <div class="btn marry">&gt; guardas los anillos en tu bolsillo. esperemos que ning√∫n ladr√≥n te los robe...</div>
      </div>
    </div>

    <!-- Cofre 2 (final/pregunta) -->
    <div id="f18">
      <div id="f19">
        <h3>¬°pero si ya hemos llegado al final! ¬øtan r√°pido?</h3>
        <h2>¬°oh, no, pausa, pausa! a√∫n queda una √∫ltima cosa...</h2>
        <div class="decidir"><div class="btn meme">&gt; ¬øqueda algo m√°s?</div></div>
      </div>

      <div id="f20">
        <h3>s√≠, necesitamos que respondas una pregunta... ¬°es solo una!</h3>
        <h2>aqu√≠ vamos</h2>
        <div class="decidir"><div class="btn meme2">&gt; ¬øs-supongo que s√≠...?</div></div>
      </div>

      <div id="f21">
        <h3>ichigo. una vez no ha sido suficiente y quiero o√≠rlo de nuevo.</h3>
        <h2>¬øquieres casarte conmigo?</h2>
        <div class="decidir">
          <div class="btn yes">&gt; ¬°SIIII!</div>
          <div class="btn yes" style="color:red">&gt; ¬°SIIII EN ROJO!</div>
        </div>
      </div>

      <div id="f22">
        me gustar√≠a decir que tengo un final para esta historia, pero, ambos sabemos que apenas estamos comenzando...
      </div>
    </div>
  </div>

  <!-- Confirmador -->
  <div id="confirm" role="dialog" aria-modal="true" aria-label="Confirmaci√≥n">
    <div class="panel">
      <div>¬øEst√°s segura?</div>
      <div class="actions">
        <div class="btn ok">Abrir cofre</div>
        <div class="btn cancel">Cancelar</div>
      </div>
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script>
    function showFlex(sel){ $(sel).css('display','flex'); }
    function showBlock(sel){ $(sel).css('display','block'); }
    function hide(sel){ $(sel).css('display','none'); }

    /* ===== AUDIO: autoplay + fallback t√°ctil ===== */
    (function(){
      const audio = document.getElementById('bgm');
      const btn = document.getElementById('audioToggle');
      audio.volume = 0.85;
      audio.muted = false;

      function unlockOnGesture(){
        const resume = () => {
          audio.muted = false;
          audio.play().catch(()=>{});
          window.removeEventListener('pointerdown', resume);
          window.removeEventListener('keydown', resume);
        };
        window.addEventListener('pointerdown', resume, {once:true});
        window.addEventListener('keydown', resume, {once:true});
      }

      audio.play().then(()=>{/* ok */}).catch(()=>{
        audio.muted = true;           // reproduce en silencio
        audio.play().finally(unlockOnGesture); // y habilita sonido al primer gesto
      });

      btn.addEventListener('click', ()=>{
        if(audio.muted){ audio.muted=false; btn.textContent='üîä M√∫sica'; audio.play().catch(()=>{}); }
        else{ audio.muted=true; btn.textContent='üîá Silencio'; }
      });
    })();

    /* ===== H√âROE + Controles: teclado y DESLIZ t√°ctil ===== */
    (function(){
      const hero = { el:null, x:0, y:0, w:0, h:0, speed:3.2, dir:'up' };
      const keys = { up:false, down:false, left:false, right:false };
      let running = false, canMove = false;

      const css = getComputedStyle(document.documentElement);
      function boundsObj(){
        return {
          top: parseInt(css.getPropertyValue('--wallTop')) || 60,
          left: parseInt(css.getPropertyValue('--wallX'))  || 40,
          right:parseInt(css.getPropertyValue('--wallX'))  || 40,
          bottom:parseInt(css.getPropertyValue('--wallBottom')) || 85
        };
      }
      let bounds = boundsObj();

      // Empieza un poco ‚Äúafuera‚Äù
      const doorOutsideFactor = 0.28;

      function start(){
        const pf = document.getElementById('f7');
        hero.el = document.getElementById('hero');
        hero.w = parseInt(getComputedStyle(hero.el).width);
        hero.h = parseInt(getComputedStyle(hero.el).height);
        const W = pf.clientWidth, H = pf.clientHeight;
        hero.x = W/2;
        hero.y = H - hero.h*(0.5 - doorOutsideFactor);
        place();
        if(!running){ running = true; requestAnimationFrame(loop); }
        attachTouchControls(pf);
        window.addEventListener('resize', ()=>{ bounds = boundsObj(); });
      }

      function place(){ hero.el.style.left = hero.x+'px'; hero.el.style.top = hero.y+'px'; }

      function loop(){
        if(!running) return;
        const pf = document.getElementById('f7');
        const W = pf.clientWidth, H = pf.clientHeight;

        let vx = 0, vy = 0;
        if(canMove){
          if(keys.left)  vx -= hero.speed;
          if(keys.right) vx += hero.speed;
          if(keys.up)    vy -= hero.speed;
          if(keys.down)  vy += hero.speed;
          if(vx && vy){ vx*=0.7071; vy*=0.7071; } // 45¬∞
        }

        hero.x += vx; hero.y += vy;

        if(canMove){
          const minX = bounds.left + hero.w/2;
          const minY = bounds.top  + hero.h/2;
          const maxX = W - (bounds.right + hero.w/2);
          const maxY = H - (bounds.bottom + hero.h/2);
          if(hero.x < minX) hero.x = minX;
          if(hero.y < minY) hero.y = minY;
          if(hero.x > maxX) hero.x = maxX;
          if(hero.y > maxY) hero.y = maxY;
        }

        if(canMove){
          if(vx>0) setDir('right');
          else if(vx<0) setDir('left');
          else if(vy>0) setDir('down');
          else if(vy<0) setDir('up');
        }

        place();
        chestProximity();
        requestAnimationFrame(loop);
      }

      function setDir(d){
        if(hero.dir===d) return;
        hero.el.classList.remove('dir-up','dir-down','dir-left','dir-right');
        hero.el.classList.add('dir-'+d);
        hero.dir = d;
      }

      /* ==== Teclado ==== */
      function key(e,down){
        const k = e.key.toLowerCase();
        if(['arrowup','w'].includes(k)){ keys.up = down; e.preventDefault(); }
        if(['arrowdown','s'].includes(k)){ keys.down = down; e.preventDefault(); }
        if(['arrowleft','a'].includes(k)){ keys.left = down; e.preventDefault(); }
        if(['arrowright','d'].includes(k)){ keys.right = down; e.preventDefault(); }
      }
      window.addEventListener('keydown', e=>key(e,true), {passive:false});
      window.addEventListener('keyup',   e=>key(e,false), {passive:false});

      /* ==== Desliz t√°ctil / pointer (joystick virtual simple) ==== */
      function attachTouchControls(surface){
        let touching = false;
        let startX=0, startY=0;

        surface.addEventListener('pointerdown', (e)=>{
          if(!canMove) return;    // no activar hasta que se permita
          touching = true;
          startX = e.clientX; startY = e.clientY;
          setFromDelta(0,0);      // limpia
        }, {passive:true});

        surface.addEventListener('pointermove', (e)=>{
          if(!touching || !canMove) return;
          const dx = e.clientX - startX;
          const dy = e.clientY - startY;
          setFromDelta(dx, dy);
          e.preventDefault();     // evita scroll mientras arrastras
        }, {passive:false});

        const stop = ()=>{
          touching = false;
          keys.up = keys.down = keys.left = keys.right = false;
        };
        surface.addEventListener('pointerup', stop, {passive:true});
        surface.addEventListener('pointercancel', stop, {passive:true});

        function setFromDelta(dx,dy){
          const dead = 8; // zona muerta m√≠nima
          keys.left = keys.right = keys.up = keys.down = false;
          if(Math.abs(dx) < dead && Math.abs(dy) < dead) return;
          if(Math.abs(dx) > Math.abs(dy)){
            if(dx>0) keys.right = true; else keys.left = true;
          }else{
            if(dy>0) keys.down = true; else keys.up = true;
          }
        }
      }

      // ‚ÄúTemblor‚Äù de cofres al acercarse
      function chestProximity(){
        if(!canMove){ hide('#wizardHint'); return; }
        const heroRect = hero.el.getBoundingClientRect();
        let near = false;
        document.querySelectorAll('#f10 .box').forEach(box=>{
          const r = box.getBoundingClientRect();
          const cx = r.left + r.width/2, cy = r.top + r.height/2;
          const hx = heroRect.left + heroRect.width/2, hy = heroRect.top + heroRect.height/2;
          const dist = Math.hypot(cx-hx, cy-hy);
          const threshold = Math.max(120, parseInt(getComputedStyle(box).width) * 1.2);
          if(dist < threshold){ box.classList.add('wiggle'); near = true; }
          else{ box.classList.remove('wiggle'); }
        });
        if(near) showFlex('#wizardHint'); else hide('#wizardHint');
      }

      // Confirmador reutilizable
      function openConfirm(onOk){
        const $c = $('#confirm'); showFlex('#confirm');
        $c.find('.ok').off('click').on('click', ()=>{ hide('#confirm'); onOk(); });
        $c.find('.cancel').off('click').on('click', ()=>{ hide('#confirm'); });
      }

      // Cofres: click ‚Üí confirma ‚Üí abre y salta de fase
      function attachChestClicks(){
        $('#f10 .box').each(function(){
          const $box = $(this);
          const target = '#'+$box.data('target'); // f12, f15, f18
          $box.on('click', function(){
            openConfirm(()=>{
              $box.addClass('opened');
              hide('#f7'); hide('#wizardHint'); showBlock(target);
              if(target==='#f12'){ showBlock('#f13'); }
              if(target==='#f15'){ showFlex('#f16'); }
              if(target==='#f18'){ showFlex('#f19'); }
            });
          });
        });
      }

      // API p√∫blica para el flujo
      window.__heroCtrl = {
        start,
        enable:()=>{ canMove=true; },
        disable:()=>{ canMove=false; keys.up=keys.down=keys.left=keys.right=false; }
      };

      attachChestClicks();
    })();

    /* ===== FLUJO / DI√ÅLOGOS ===== */
    $(function(){
      showFlex('#f1');

      $('.q1-no').on('click', function(){ hide('.frame'); showFlex('#close1'); });
      $('.q1-si').on('click', function(){ hide('#f1'); showFlex('#f2new'); });

      $('.q2-no').on('click', function(){ hide('.frame'); showFlex('#close2'); });
      $('.q2-seguir').on('click', function(){ hide('#f2new'); showFlex('#f3new'); });

      $('.q3-beso, .q3-cocacho').on('click', function(){ hide('#f3new'); showFlex('#f4new'); });

      $('.q4-no').on('click', function(){ hide('#f4new'); showFlex('#f5new'); });
      $('.q4-seguir').on('click', function(){ hide('.frame'); showFlex('#f6'); });

      // Entrar al mundo
      $('.afi').on('click', function(){
        hide('#f6'); showFlex('#f7'); showFlex('#f8');
        __heroCtrl.start();    // la pone en la ‚Äúpuerta‚Äù
        __heroCtrl.disable();  // no se mueve hasta las cajas
      });

      $('.salu').on('click', function(){ hide('#f8'); showFlex('#f9'); });

      $('.copy').on('click', function(){
        hide('#f9'); showFlex('#f10'); showFlex('#f11');
        __heroCtrl.enable();   // ahora s√≠ puede moverse (teclado + dedo)
      });

      // Carta
      $('.go').on('click', function(){ hide('#f13'); showBlock('#f14'); });
      $('.carta').on('click', function(){ hide('#f12'); showFlex('#f7'); showFlex('#f10'); showFlex('#f11'); __heroCtrl.enable(); });

      // Anillos
      $('.anillo').on('click', function(){ hide('#f16'); showFlex('#f17'); });
      $('.marry').on('click', function(){ hide('#f15'); showFlex('#f7'); showFlex('#f10'); showFlex('#f11'); __heroCtrl.enable(); });

      // Final
      $('.meme').on('click', function(){ hide('#f19'); showFlex('#f20'); });
      $('.meme2').on('click', function(){ hide('#f20'); showFlex('#f21'); });
      $('.yes').on('click', function(){ hide('#f21'); showFlex('#f22'); });

      // Accesibilidad
      $('.btn').attr('tabindex','0').attr('role','button');
      $(document).on('keydown', function(e){
        if(e.key === 'Enter' || e.key === ' '){
          const el = document.activeElement;
          if($(el).is('.btn')){ e.preventDefault(); $(el).click(); }
        }
      });
    });
  </script>
</body>
</html>
