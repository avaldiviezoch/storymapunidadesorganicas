<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>La Aventura ‚Äî Regalo interactivo</title>

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inconsolata:wght@200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">

  <style>
    :root{ --pink:#ff60b4; --blue:#72efff; }
    html,body{height:100%}
    body{
      margin:0; background:#111; background-attachment:fixed; background-size:cover;
      color:#f9f9f9; font-family: Inconsolata, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }
    a{ text-decoration:none; color:#f9f9f9 }

    #out-all{
      position:fixed; inset:0; display:flex; align-items:center; justify-content:center; padding:16px;
    }

    /* Marco base para cada "pantalla" */
    .frame{
      position:absolute; width:720px; max-width:94vw; min-height:300px; max-height:86vh;
      display:none; align-items:center; justify-content:center; flex-direction:column;
      background:#111; box-shadow:0 10px 40px rgba(0,0,0,.4); border-radius:12px; padding:20px;
      text-align:center; gap:8px;
    }
    #f1{display:flex}

    .decidir{display:flex; align-items:center; justify-content:center; flex-wrap:wrap}
    .btn{
      font:25px 'VT323', monospace; margin:10px; opacity:0; animation:visible 1s 0.6s forwards;
      cursor:pointer; color:#f9f9f9; padding:8px 14px; border-radius:10px; border:1px dashed rgba(255,255,255,.18)
    }
    .btn:focus{ outline:2px dashed var(--blue); outline-offset:2px }

    h1,h2,h3{margin:6px 10px}
    h1{
      overflow:hidden; border-right:.15em solid #fff; white-space:nowrap; letter-spacing:.03em;
      animation: typing 2.8s steps(38,end), blink-caret .75s step-end infinite;
      font:30px 'VT323', monospace;
    }
    h2,h3{font:26px 'VT323', monospace}

    /* Mundo (cueva retro) */
    #f7{
      position:absolute; width:850px; max-width:95vw; height:550px; max-height:85vh;
      background:url(https://i.imgur.com/kx3psEN.png) center/cover no-repeat;
      display:none; align-items:center; justify-content:center; flex-direction:column;
      border-radius:14px; box-shadow:0 20px 60px rgba(0,0,0,.45);
      overflow:hidden;
    }

    /* Texto/cofres */
    #f8,#f9{position:absolute; bottom:150px; left:150px; right:150px; display:none; align-items:center; justify-content:center; flex-direction:column; text-align:center;}
    #f10{position:absolute; bottom:140px; left:150px; right:150px; height:160px; display:none; align-items:center; justify-content:center;}
    .box{width:100px; height:100px; background:url(https://i.imgur.com/ViqP2fB.png) center/cover no-repeat; margin:20px; cursor:pointer; transition:transform .15s ease}
    .box:hover{background:url(https://i.imgur.com/FIrcwmM.png) center/cover no-repeat; transform:translateY(-2px)}
    #f11{position:absolute; top:120px; transform:scale(.7); display:none; flex-direction:column; text-align:center;}

    /* Cartas, anillos, etc. */
    #f12,#f18{position:absolute; inset:0; background:#111; display:none; align-items:center; justify-content:center; flex-direction:column;}
    #f13{display:none; text-align:center}
    #f13 a{display:inline-block; margin-top:10px}
    #f14,#f15{background:#111; position:absolute; inset:0; font:26px 'VT323', monospace; text-align:justify; display:none; padding:28px; line-height:1.35;}
    #f16,#f17{position:absolute; inset:0; display:none; align-items:center; justify-content:center; flex-direction:column; gap:12px}
    .ring{width:150px; height:150px; background:url(https://i.imgur.com/oEs8TdL.png) center/cover no-repeat}
    .ichigo{width:200px; height:200px; background:url(https://i.imgur.com/hGY3pGX.png) center/cover no-repeat}
    #f19,#f20,#f21,#f22{position:absolute; inset:0; background:#111; display:none; align-items:center; justify-content:center; flex-direction:column; text-align:center; padding:24px;}
    #f22{font:26px 'VT323', monospace; text-align:justify}

    /* Avatar frente (pantalla f6) */
    .img1{
      width:120px; height:120px;
      background:url(https://lh3.googleusercontent.com/d/1IWFy6CLWeEFBnuv1do-p9O2xiO8mP8na=w1000) center/contain no-repeat;
      margin-bottom:8px; border-radius:14px; padding:6px;
      background-color:rgba(255,255,255,.02);
      outline:1px solid rgba(255,255,255,.08);
      box-shadow:0 6px 18px rgba(0,0,0,.25);
    }

    /* ====== H√âROE MOVIBLE (usa tus 4 sprites) ====== */
    #hero{
      position:absolute; width:110px; height:110px;
      /* lo dejaremos centrado en X y en la ‚Äúpuerta‚Äù exacta con JS */
      pointer-events:none; z-index:20;
      background-position:center; background-repeat:no-repeat; background-size:contain;
      border-radius:16px; padding:6px;
      background-color:rgba(0,0,0,.18);
      outline:1px solid rgba(255,255,255,.07);
      box-shadow:0 10px 28px rgba(0,0,0,.35);
      image-rendering: pixelated;
      transform: translate(-50%, -50%); /* las coordenadas que use JS ser√°n el centro */
      left:50%; top:50%;                 /* valores iniciales (ser√°n reemplazados) */
    }
    .dir-up    { background-image:url(https://lh3.googleusercontent.com/d/1mSX8bhUoXpRKsKlufh9bKKX2JsckTxvP=w1000); } /* ESPALDAS */
    .dir-down  { background-image:url(https://lh3.googleusercontent.com/d/1IWFy6CLWeEFBnuv1do-p9O2xiO8mP8na=w1000); } /* FRENTE  */
    .dir-left  { background-image:url(https://lh3.googleusercontent.com/d/1_uQuJXLlecsnZnjiRlsgdgf9PrfJoJS_=w1000); } /* IZQ     */
    .dir-right { background-image:url(https://lh3.googleusercontent.com/d/1m0lnXiIshE7uJE1sGA5HkdkcnZR01nIc=w1000); } /* DER     */

    /* Bot√≥n de audio */
    #audioToggle{
      position:fixed; right:12px; bottom:12px; z-index:9999;
      font:18px 'VT323', monospace; padding:8px 12px; border-radius:10px;
      background:#1d1d1d; color:#fff; border:1px solid rgba(255,255,255,.15);
      cursor:pointer; user-select:none;
    }

    /* Animaciones */
    @keyframes typing{from{width:0} to{width:105%}}
    @keyframes blink-caret{from,to{border-color:transparent} 50%{border-color:#fff}}
    @keyframes visible{from{opacity:0} to{opacity:1}}

    @media (max-width:560px){
      h1,h2,h3{font-size:22px}
      #f11{transform:scale(.9)}
      #hero{ width:96px; height:96px; }
      .img1{ width:100px; height:100px; }
    }
  </style>
</head>
<body>
  <!-- AUDIO GLOBAL (autoplay con fallback) -->
  <audio id="bgm" src="https://lh3.googleusercontent.com/d/1CyZVteqNTVDNAjZiUQZxczR4azqBSakX=w1000"
         autoplay loop playsinline></audio>
  <div id="audioToggle">üîä M√∫sica</div>

  <div id="out-all">

    <!-- PREGUNTAS INICIALES -->
    <div id="f1" class="frame">
      <h1>¬øQuieres saber algo de m√≠?</h1>
      <div class="decidir">
        <div class="btn q1-si">&gt; s√≠</div>
        <div class="btn q1-no">&gt; no</div>
      </div>
    </div>

    <div id="close1" class="frame"><h2>Entiendo, cierra el aplicativo y disculpa las molestias.</h2></div>

    <div id="f2new" class="frame">
      <h3>A veces las parejas pelean, a veces t√∫ te cansas de repetir cosas a tu pareja, pero no significa que no te escuche: solo que hace las cosas diferente‚Ä¶</h3>
      <div class="decidir">
        <div class="btn q2-seguir">&gt; seguir</div>
        <div class="btn q2-no">&gt; no seguir</div>
      </div>
    </div>

    <div id="close2" class="frame"><h2>Entiendo, cierra el aplicativo y disculpa las molestias.</h2></div>

    <div id="f3new" class="frame">
      <h3>Antonio dice que no significa que no te ame; hace todo por ti y te da detalles ‚Äîno siempre en los mismos d√≠as‚Äî y tambi√©n se frustra cuando le dices cosas que no hace.</h3>
      <div class="decidir">
        <div class="btn q3-beso">&gt; darle un beso?</div>
        <div class="btn q3-cocacho">&gt; darle un cocacho</div>
      </div>
    </div>

    <div id="f4new" class="frame">
      <h3>Si no quieres seguir en esta aventura, es entendible, pero √©l se supera cada d√≠a y espera seguir.</h3>
      <div class="decidir">
        <div class="btn q4-seguir">&gt; seguir aventura?</div>
        <div class="btn q4-no">&gt; no seguir aventura</div>
      </div>
    </div>

    <div id="f5new" class="frame"><h3>Antonio recibi√≥ un correo electr√≥nico diciendo que pusiste ‚Äúno seguir aventura‚Äù :(</h3></div>

    <!-- INICIO DEL JUEGO -->
    <div id="f6" class="frame" style="display:none">
      <div class="img1"></div>
      <h3>esta eres t√∫, con tu pelo un poco largo y tu ropa amarilla en tendencia; jugaremos un juego: tienes que escoger algo del poderoso mago.</h3>
      <div class="btn afi">Comenzar !!!</div>
    </div>

    <!-- MUNDO (con movimiento desbloqueable) -->
    <div id="f7">
      <!-- H√©roe inicia parado en la puerta (abajo) mirando hacia arriba -->
      <div id="hero" class="dir-up"></div>

      <!-- Secuencia de di√°logo antes de moverse -->
      <div id="f8">
        <h1>Hoooola lucero, soy un poderoso mago y jugaremos a las cajas escondidas</h1>
        <div class="decidir"><div class="btn salu">Hola????</div></div>
      </div>

      <div id="f9">
        <h1>aqui hay 3 cajas escoje bien porque de eso dependar tu futuro , Wuajajajajaja</h1>
        <div class="decidir"><div class="btn copy">Moverme</div></div>
      </div>

      <!-- Al mostrar f10 y f11 se habilita el movimiento -->
      <div id="f10">
        <div class="box ca1"></div>
        <div class="box ca2"></div>
        <div class="box ca3"></div>
      </div>

      <div id="f11"><h3>escoge con sabiduria!!</h3></div>
    </div>

    <!-- Cofre 1 -->
    <div id="f12">
      <div id="f13">
        <h1>por favor, reproduce esta canci√≥n antes de leer</h1>
        <a href="https://open.spotify.com/track/6EBPGW7GqFlGYAY1fSXwjI?si=5spKltg4SJu6NXFOkXVvMw" target="_blank" rel="noopener noreferrer">&gt; reproduces la canci√≥n.</a>
        <br/>
        <span class="btn go">&gt; seguir leyendo.</span>
      </div>

      <div id="f14">
        Si alguien me hubiera preguntado siete meses atr√°s si cre√≠a volver a darme la oportunidad de estar con alguien, me habr√≠a re√≠do en su cara...
        <br><br>
        <div class="btn carta">&gt; vuelves a abrir las otras cajas.</div>
      </div>
    </div>

    <!-- Cofre 3 (anillos) -->
    <div id="f15">
      <div id="f16">
        <h3>¬°Oh, mira, ves algo brillante ah√≠ al centro!</h3>
        <h2>Deber√≠as tomarlo...</h2>
        <div class="btn anillo">&gt; lo recoges.</div>
      </div>

      <div id="f17">
        <div class="ring"></div>
        <div class="ichigo"></div>
        <h3>¬°has encontrado los anillos!, pero... ¬øpara qu√© se supone que son?</h3>
        <h2>¬øquieres llev√°rtelos?</h2>
        <div class="btn marry">&gt; guardas los anillos en tu bolsillo. esperemos que ning√∫n ladr√≥n te los robe...</div>
      </div>
    </div>

    <!-- Cofre 2 (final/pregunta) -->
    <div id="f18">
      <div id="f19">
        <h3>¬°pero si ya hemos llegado al final! ¬øtan r√°pido?</h3>
        <h2>¬°oh, no, pausa, pausa! a√∫n queda una √∫ltima cosa...</h2>
        <div class="decidir"><div class="btn meme">&gt; ¬øqueda algo m√°s?</div></div>
      </div>

      <div id="f20">
        <h3>s√≠, necesitamos que respondas una pregunta... ¬°es solo una!</h3>
        <h2>aqu√≠ vamos</h2>
        <div class="decidir"><div class="btn meme2">&gt; ¬øs-supongo que s√≠...?</div></div>
      </div>

      <div id="f21">
        <h3>ichigo. una vez no ha sido suficiente y quiero o√≠rlo de nuevo.</h3>
        <h2>¬øquieres casarte conmigo?</h2>
        <div class="decidir">
          <div class="btn yes">&gt; ¬°SIIII!</div>
          <div class="btn yes" style="color:red">&gt; ¬°SIIII EN ROJO!</div>
        </div>
      </div>

      <div id="f22">
        me gustar√≠a decir que tengo un final para esta historia, pero, ambos sabemos que apenas estamos comenzando...
      </div>
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script>
    function showFlex(sel){ $(sel).css('display','flex'); }
    function showBlock(sel){ $(sel).css('display','block'); }
    function hide(sel){ $(sel).css('display','none'); }

    // ======== AUDIO GLOBAL ========
    (function(){
      const audio = document.getElementById('bgm');
      const btn = document.getElementById('audioToggle');
      audio.volume = 0.35;

      function tryPlay(){
        audio.play().then(()=>{ /* ok */ }).catch(()=>{
          // algunos navegadores bloquean autoplay con sonido hasta interacci√≥n
          const resume = () => {
            audio.muted = false;
            audio.play().catch(()=>{ /* si falla, no hacemos nada */ });
            window.removeEventListener('click', resume);
            window.removeEventListener('keydown', resume);
          };
          window.addEventListener('click', resume, {once:true});
          window.addEventListener('keydown', resume, {once:true});
        });
      }
      tryPlay();

      btn.addEventListener('click', ()=>{
        if(audio.muted){ audio.muted = false; btn.textContent = 'üîä M√∫sica'; audio.play().catch(()=>{}); }
        else{ audio.muted = true; btn.textContent = 'üîá Silencio'; }
      });
    })();

    // ======== CONTROL DE MOVIMIENTO DEL H√âROE (bloqueable) =========
    (function(){
      const hero = { el:null, x:0, y:0, w:110, h:110, speed:3.2, dir:'up' };
      const keys = { up:false, down:false, left:false, right:false };
      let running = false;
      let canMove = false; // se habilita reci√©n con las cajas

      // l√≠mites internos (aj√∫stalos si quieres):
      const bounds = { top:60, left:40, right:40, bottom:120 }; // m√°s fondo para no pisar la muralla

      // ‚Äúpuerta‚Äù exacta: centrado y a 115px del borde inferior
      const doorOffsetBottom = 115;

      // Preload sprites
      [
        "https://lh3.googleusercontent.com/d/1mSX8bhUoXpRKsKlufh9bKKX2JsckTxvP=w1000",
        "https://lh3.googleusercontent.com/d/1IWFy6CLWeEFBnuv1do-p9O2xiO8mP8na=w1000",
        "https://lh3.googleusercontent.com/d/1_uQuJXLlecsnZnjiRlsgdgf9PrfJoJS_=w1000",
        "https://lh3.googleusercontent.com/d/1m0lnXiIshE7uJE1sGA5HkdkcnZR01nIc=w1000"
      ].forEach(src=>{ const i=new Image(); i.src=src; });

      function start(){
        const pf = document.getElementById('f7');
        hero.el = document.getElementById('hero');
        const W = pf.clientWidth, H = pf.clientHeight;
        // Coloca al centro X y puerta Y exacta (coordenadas = centro visual por transform)
        hero.x = W/2;
        hero.y = H - doorOffsetBottom;
        place();
        if(!running){ running = true; requestAnimationFrame(loop); }
      }

      function place(){
        hero.el.style.left = hero.x + 'px';
        hero.el.style.top  = hero.y + 'px';
      }

      function loop(){
        if(!running) return;
        const pf = document.getElementById('f7');
        const W = pf.clientWidth, H = pf.clientHeight;

        let vx = 0, vy = 0;
        if(canMove){
          if(keys.left)  vx -= hero.speed;
          if(keys.right) vx += hero.speed;
          if(keys.up)    vy -= hero.speed;
          if(keys.down)  vy += hero.speed;
          if(vx && vy){ vx*=0.7071; vy*=0.7071; }
        }

        hero.x += vx; hero.y += vy;

        // l√≠mites (en coordenadas de centro)
        const minX = bounds.left + hero.w/2;
        const minY = bounds.top  + hero.h/2;
        const maxX = W - (bounds.right + hero.w/2);
        const maxY = H - (bounds.bottom + hero.h/2);

        if(hero.x < minX) hero.x = minX;
        if(hero.y < minY) hero.y = minY;
        if(hero.x > maxX) hero.x = maxX;
        if(hero.y > maxY) hero.y = maxY;

        if(canMove){
          if(vx>0){ setDir('right'); }
          else if(vx<0){ setDir('left'); }
          else if(vy>0){ setDir('down'); }
          else if(vy<0){ setDir('up'); }
        }

        place();
        requestAnimationFrame(loop);
      }

      function setDir(d){
        if(hero.dir===d) return;
        hero.el.classList.remove('dir-up','dir-down','dir-left','dir-right');
        hero.el.classList.add('dir-'+d);
        hero.dir = d;
      }

      function key(e,down){
        const k = e.key.toLowerCase();
        if(['arrowup','w'].includes(k)){ keys.up = down; e.preventDefault(); }
        if(['arrowdown','s'].includes(k)){ keys.down = down; e.preventDefault(); }
        if(['arrowleft','a'].includes(k)){ keys.left = down; e.preventDefault(); }
        if(['arrowright','d'].includes(k)){ keys.right = down; e.preventDefault(); }
      }

      window.addEventListener('keydown', e=>key(e,true), {passive:false});
      window.addEventListener('keyup',   e=>key(e,false), {passive:false});

      // API para el flujo
      window.__heroCtrl = {
        start, enable:()=>{ canMove=true; }, disable:()=>{ canMove=false; }
      };
    })();

    // ======== FLUJO / DI√ÅLOGOS =========
    $(function(){
      // Arranque en Q1 (#f1)
      showFlex('#f1');

      // Q1
      $('.q1-no').on('click', function(){ hide('.frame'); showFlex('#close1'); });
      $('.q1-si').on('click', function(){ hide('#f1'); showFlex('#f2new'); });

      // Q2
      $('.q2-no').on('click', function(){ hide('.frame'); showFlex('#close2'); });
      $('.q2-seguir').on('click', function(){ hide('#f2new'); showFlex('#f3new'); });

      // Q3
      $('.q3-beso, .q3-cocacho').on('click', function(){ hide('#f3new'); showFlex('#f4new'); });

      // Q4
      $('.q4-no').on('click', function(){ hide('#f4new'); showFlex('#f5new'); });
      $('.q4-seguir').on('click', function(){
        hide('.frame'); // cierra frames de preguntas
        showFlex('#f6');
      });

      // Entrar al mundo: Lucero queda en la puerta, sin moverse todav√≠a
      $('.afi').on('click', function(){
        hide('#f6'); showFlex('#f7'); showFlex('#f8');
        __heroCtrl.start();     // coloca a Lucero en la puerta exacta
        __heroCtrl.disable();   // movimiento bloqueado hasta que aparezcan cajas
      });

      // Di√°logo con mago ‚Üí respuesta de Lucero
      $('.salu').on('click', function(){ hide('#f8'); showFlex('#f9'); });

      // Mostrar cajas y texto ‚Üí AHORA se habilita el movimiento
      $('.copy').on('click', function(){
        hide('#f9'); showFlex('#f10'); showFlex('#f11');
        __heroCtrl.enable();    // movimiento habilitado reci√©n aqu√≠
      });

      // Cofres / resto del flujo
      $('.ca1').on('click', function(){ showFlex('#f12'); showBlock('#f13'); });
      $('.go').on('click', function(){ hide('#f13'); showBlock('#f14'); });
      $('.carta').on('click', function(){ hide('#f12'); });

      $('.ca3').on('click', function(){ showBlock('#f15'); showFlex('#f16'); });
      $('.anillo').on('click', function(){ hide('#f16'); showFlex('#f17'); });
      $('.marry').on('click', function(){ hide('#f15'); hide('#f17'); });

      $('.ca2').on('click', function(){ showBlock('#f18'); showFlex('#f19'); });
      $('.meme').on('click', function(){ hide('#f19'); showFlex('#f20'); });
      $('.meme2').on('click', function(){ hide('#f20'); showFlex('#f21'); });
      $('.yes').on('click', function(){ hide('#f21'); showFlex('#f22'); });
    });
  </script>
</body>
</html>
