<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>La Aventura ‚Äî Regalo interactivo</title>
  <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inconsolata:wght@200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  <style>
    :root{ --pink:#ff60b4; --blue:#72efff; --wallX:40px; --wallTop:60px; --wallBottom:85px; }
    html,body{height:100%; margin:0; padding:0; overflow:hidden; touch-action:none;}
    body{ background:#111; color:#f9f9f9; font-family: Inconsolata, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    a{ text-decoration:none; color:#f9f9f9 }
    #out-all{ position:fixed; inset:0; display:flex; align-items:center; justify-content:center; padding:16px; }
    .frame{
      position:absolute; width:720px; max-width:94vw; min-height:300px; max-height:86vh;
      display:none; align-items:center; justify-content:center; flex-direction:column;
      background:#111; box-shadow:0 10px 40px rgba(0,0,0,.4); border-radius:12px; padding:20px;
      text-align:center; gap:8px;
    }
    #f1{display:flex}
    .decidir{display:flex; align-items:center; justify-content:center; flex-wrap:wrap}
    .btn{
      font:25px 'VT323', monospace; margin:10px; opacity:0; animation:visible 1s .6s forwards;
      cursor:pointer; color:#f9f9f9; padding:8px 14px; border-radius:10px; border:1px dashed rgba(255,255,255,.18);
      touch-action:manipulation;
    }
    .btn:focus{ outline:2px dashed var(--blue); outline-offset:2px }
    h1,h2,h3{margin:6px 10px}
    h1{
      overflow:hidden; border-right:.15em solid #fff; white-space:nowrap; letter-spacing:.03em;
      animation: typing 2.8s steps(38,end), blink-caret .75s step-end infinite;
      font:30px 'VT323', monospace;
    }
    h2,h3{font:26px 'VT323', monospace}
    /* Mundo (cueva retro) */
    #f7{
      position:absolute; width:850px; max-width:100vw; height:550px; max-height:100vh;
      background:ur[](https://i.imgur.com/kx3psEN.png) center/cover no-repeat;
      display:none; align-items:center; justify-content:center; flex-direction:column;
      border-radius:14px; box-shadow:0 20px 60px rgba(0,0,0,.45);
      overflow:hidden; touch-action:none;
    }
    /* Di√°logos del mago y textos seguros dentro de las paredes */
    .dialogBox{
      position:absolute; left:var(--wallX); right:var(--wallX);
      display:flex; align-items:center; justify-content:center; text-align:center;
      padding:0 4px;
    }
    #f8, #f9 { bottom:150px; display:none; }
    #f11 { top:120px; display:none; }
    .dialogInner{
      max-width:min(620px, calc(100% - 16px));
      background:rgba(0,0,0,.7);
      border:1px solid rgba(255,255,255,.18);
      border-radius:12px; padding:12px 14px;
      box-shadow:0 10px 30px rgba(0,0,0,.35);
      font:22px 'VT323', monospace; line-height:1.3;
      white-space:normal; word-break:break-word;
    }
    .dialogInner p{ margin:.25em 0; }
    #f10{position:absolute; bottom:140px; left:var(--wallX); right:var(--wallX); height:160px; display:none; align-items:center; justify-content:center;}
    .box{width:100px; height:100px; background:ur[](https://i.imgur.com/ViqP2fB.png) center/cover no-repeat; margin:20px; cursor:pointer; transition:transform .15s ease}
    .box:hover{background:ur[](https://i.imgur.com/FIrcwmM.png) center/cover no-repeat; transform:translateY(-2px)}
    #f12,#f18{position:absolute; inset:0; background:#111; display:none; align-items:center; justify-content:center; flex-direction:column;}
    #f13{display:none; text-align:center}
    #f13 a{display:inline-block; margin-top:10px}
    #f14,#f15{background:#111; position:absolute; inset:0; font:26px 'VT323', monospace; text-align:justify; display:none; padding:28px; line-height:1.35;}
    #f16,#f17{position:absolute; inset:0; display:none; align-items:center; justify-content:center; flex-direction:column; gap:12px}
    .ring{width:150px; height:150px; background:ur[](https://i.imgur.com/oEs8TdL.png) center/cover no-repeat}
    .ichigo{width:200px; height:200px; background:ur[](https://i.imgur.com/hGY3pGX.png) center/cover no-repeat}
    #f19,#f20,#f21,#f22{position:absolute; inset:0; background:#111; display:none; align-items:center; justify-content:center; flex-direction:column; text-align:center; padding:24px;}
    #f22{font:26px 'VT323', monospace; text-align:justify}
    .img1{
      width:120px; height:120px;
      background:ur[](https://placehold.co/120x120/FFD700/000000/png?text=Hero) center/contain no-repeat;
      margin-bottom:8px; border-radius:14px; padding:6px;
      background-color:rgba(255,255,255,.02);
      outline:1px solid rgba(255,255,255,.08);
      box-shadow:0 6px 18px rgba(0,0,0,.25);
    }
    /* H√©roe movible */
    #hero{
      position:absolute; width:110px; height:110px;
      pointer-events:none; z-index:20;
      background-position:center; background-repeat:no-repeat; background-size:contain;
      border-radius:16px; padding:6px;
      background-color:rgba(0,0,0,.18);
      outline:1px solid rgba(255,255,255,.07);
      box-shadow:0 10px 28px rgba(0,0,0,.35);
      image-rendering: pixelated;
      transform: translate(-50%, -50%);
      left:50%; top:50%;
    }
    .dir-up { background-image:ur[](https://placehold.co/110x110/FFD700/000000/png?text=Up); }
    .dir-down { background-image:ur[](https://placehold.co/110x110/FFD700/000000/png?text=Down); }
    .dir-left { background-image:ur[](https://placehold.co/110x110/FFD700/000000/png?text=Left); }
    .dir-right { background-image:ur[](https://placehold.co/110x110/FFD700/000000/png?text=Right); }
    /* Globo del mago al acercarse a cofres */
    #wizardHint{
      position:absolute; left:var(--wallX); right:var(--wallX); top:var(--wallTop);
      display:none; z-index:50;
    }
    #wizardHint .dialogInner{ margin:0 auto; }
    /* Bot√≥n audio */
    #audioToggle{
      position:fixed; right:12px; bottom:12px; z-index:9999;
      font:18px 'VT323', monospace; padding:8px 12px; border-radius:10px;
      background:#1d1d1d; color:#fff; border:1px solid rgba(255,255,255,.15);
      cursor:pointer; user-select:none;
    }
    @keyframes typing{from{width:0} to{width:105%}}
    @keyframes blink-caret{from,to{border-color:transparent} 50%{border-color:#fff}}
    @keyframes visible{from{opacity:0} to{opacity:1}}
    @media (max-width:560px){
      :root{ --wallX:20px; --wallTop:40px; --wallBottom:70px; }
      h1,h2,h3{font-size:22px}
      #hero{ width:80px; height:80px; }
      .img1{ width:100px; height:100px; }
      .dialogInner{ font-size:20px; }
      .btn{ font-size:20px; padding:6px 12px; }
      #f7{ width:100vw; height:100vh; max-width:none; max-height:none; border-radius:0; }
      #f10{ bottom:100px; height:120px; }
      .box{ width:80px; height:80px; margin:10px; }
      .ring{ width:120px; height:120px; }
      .ichigo{ width:160px; height:160px; }
      #audioToggle{ bottom:60px; right:10px; font-size:16px; padding:6px 10px; }
    }
  </style>
</head>
<body>
  <!-- AUDIO GLOBAL -->
  <audio id="bgm" src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" autoplay loop playsinline></audio>
  <div id="audioToggle">üîä M√∫sica</div>
  <div id="out-all">
    <!-- PREGUNTAS -->
    <div id="f1" class="frame">
      <h1>¬øQuieres saber algo de m√≠?</h1>
      <div class="decidir">
        <div class="btn q1-si">&gt; s√≠</div>
        <div class="btn q1-no">&gt; no</div>
      </div>
    </div>
    <div id="close1" class="frame"><h2>Entiendo, cierra el aplicativo y disculpa las molestias.</h2></div>
    <div id="f2new" class="frame">
      <h3>A veces las parejas pelean, a veces t√∫ te cansas de repetir cosas a tu pareja, pero no significa que no te escuche: solo que hace las cosas diferente‚Ä¶</h3>
      <div class="decidir">
        <div class="btn q2-seguir">&gt; seguir</div>
        <div class="btn q2-no">&gt; no seguir</div>
      </div>
    </div>
    <div id="close2" class="frame"><h2>Entiendo, cierra el aplicativo y disculpa las molestias.</h2></div>
    <div id="f3new" class="frame">
      <h3>Antonio dice que no significa que no te ame; hace todo por ti y te da detalles ‚Äîno siempre en los mismos d√≠as‚Äî y tambi√©n se frustra cuando le dices cosas que no hace.</h3>
      <div class="decidir">
        <div class="btn q3-beso">&gt; darle un beso?</div>
        <div class="btn q3-cocacho">&gt; darle un cocacho</div>
      </div>
    </div>
    <div id="f4new" class="frame">
      <h3>Si no quieres seguir en esta aventura, es entendible, pero √©l se supera cada d√≠a y espera seguir.</h3>
      <div class="decidir">
        <div class="btn q4-seguir">&gt; seguir aventura?</div>
        <div class="btn q4-no">&gt; no seguir aventura</div>
      </div>
    </div>
    <div id="f5new" class="frame"><h3>Antonio recibi√≥ un correo electr√≥nico diciendo que pusiste ‚Äúno seguir aventura‚Äù :(</h3></div>
    <!-- INICIO JUEGO -->
    <div id="f6" class="frame" style="display:none">
      <div class="img1"></div>
      <h3>esta eres t√∫, con tu pelo un poco largo y tu ropa amarilla en tendencia; jugaremos un juego: tienes que escoger algo del poderoso mago.</h3>
      <div class="btn afi">Comenzar !!!</div>
    </div>
    <!-- MUNDO -->
    <div id="f7">
      <!-- Hint cerca de cofres -->
      <div id="wizardHint" class="dialogBox">
        <div class="dialogInner">
          <p>¬øEst√°s segura?</p>
          <p>Dale click al cofre.</p>
        </div>
      </div>
      <!-- H√©roe (empieza ‚Äúafuera‚Äù, pegado a la puerta) -->
      <div id="hero" class="dir-up"></div>
      <!-- Di√°logos del mago en cajas responsivas -->
      <div id="f8" class="dialogBox">
        <div class="dialogInner">
          <p>Hoooola, Lucero. Soy un poderoso mago‚Ä¶</p>
          <p>Jugaremos a <strong>las cajas escondidas</strong>. Presta atenci√≥n.</p>
        </div>
        <div class="decidir"><div class="btn salu">Hola????</div></div>
      </div>
      <div id="f9" class="dialogBox">
        <div class="dialogInner">
          <p>Aqu√≠ hay <strong>3 cajas</strong>. ¬°Escoge bien porque de eso depender√° tu futuro!</p>
          <p>Wuajajajajaja‚Ä¶</p>
        </div>
        <div class="decidir"><div class="btn copy">Moverme</div></div>
      </div>
      <div id="f10">
        <div class="box ca1"></div>
        <div class="box ca2"></div>
        <div class="box ca3"></div>
      </div>
      <div id="f11" class="dialogBox">
        <div class="dialogInner"><p>¬°Escoge con sabidur√≠a!</p></div>
      </div>
    </div>
    <!-- Cofre 1 -->
    <div id="f12">
      <div id="f13">
        <h1>por favor, reproduce esta canci√≥n antes de leer</h1>
        <a href="https://open.spotify.com/track/6EBPGW7GqFlGYAY1fSXwjI?si=5spKltg4SJu6NXFOkXVvMw" target="_blank" rel="noopener noreferrer">&gt; reproduces la canci√≥n.</a>
        <br/>
        <span class="btn go">&gt; seguir leyendo.</span>
      </div>
      <div id="f14">
        Si alguien me hubiera preguntado siete meses atr√°s si cre√≠a volver a darme la oportunidad de estar con alguien, me habr√≠a re√≠do en su cara...
        <br><br>
        <div class="btn carta">&gt; vuelves a abrir las otras cajas.</div>
      </div>
    </div>
    <!-- Cofre 3 (anillos) -->
    <div id="f15">
      <div id="f16">
        <h3>¬°Oh, mira, ves algo brillante ah√≠ al centro!</h3>
        <h2>Deber√≠as tomarlo...</h2>
        <div class="btn anillo">&gt; lo recoges.</div>
      </div>
      <div id="f17">
        <div class="ring"></div>
        <div class="ichigo"></div>
        <h3>¬°has encontrado los anillos!, pero... ¬øpara qu√© se supone que son?</h3>
        <h2>¬øquieres llev√°rtelos?</h2>
        <div class="btn marry">&gt; guardas los anillos en tu bolsillo. esperemos que ning√∫n ladr√≥n te los robe...</div>
      </div>
    </div>
    <!-- Cofre 2 (final/pregunta) -->
    <div id="f18">
      <div id="f19">
        <h3>¬°pero si ya hemos llegado al final! ¬øtan r√°pido?</h3>
        <h2>¬°oh, no, pausa, pausa! a√∫n queda una √∫ltima cosa...</h2>
        <div class="decidir"><div class="btn meme">&gt; ¬øqueda algo m√°s?</div></div>
      </div>
      <div id="f20">
        <h3>s√≠, necesitamos que respondas una pregunta... ¬°es solo una!</h3>
        <h2>aqu√≠ vamos</h2>
        <div class="decidir"><div class="btn meme2">&gt; ¬øs-supongo que s√≠...?</div></div>
      </div>
      <div id="f21">
        <h3>ichigo. una vez no ha sido suficiente y quiero o√≠rlo de nuevo.</h3>
        <h2>¬øquieres casarte conmigo?</h2>
        <div class="decidir">
          <div class="btn yes">&gt; ¬°SIIII!</div>
          <div class="btn yes" style="color:red">&gt; ¬°SIIII EN ROJO!</div>
        </div>
      </div>
      <div id="f22">
        me gustar√≠a decir que tengo un final para esta historia, pero, ambos sabemos que apenas estamos comenzando...
      </div>
    </div>
  </div>
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script>
    function showFlex(sel){ $(sel).css('display','flex'); }
    function showBlock(sel){ $(sel).css('display','block'); }
    function hide(sel){ $(sel).css('display','none'); }
    /* ======= AUDIO GLOBAL ======= */
    (function(){
      const audio = document.getElementById('bgm');
      const btn = document.getElementById('audioToggle');
      audio.volume = 0.8;
      audio.muted = false;
      function tryPlay(){
        audio.play().catch((err)=>{
          console.error('Audio playback failed:', err);
          const resume = () => {
            audio.muted = false;
            audio.play().catch((err)=>console.error('Retry failed:', err));
            document.removeEventListener('touchstart', resume);
            document.removeEventListener('click', resume);
          };
          document.addEventListener('touchstart', resume, {once:true});
          document.addEventListener('click', resume, {once:true});
        });
      }
      tryPlay();
      btn.addEventListener('click', ()=>{
        if(audio.muted){
          audio.muted = false;
          btn.textContent='üîä M√∫sica';
          audio.play().catch((err)=>console.error('Play failed:', err));
        } else {
          audio.muted = true;
          btn.textContent='üîá Silencio';
        }
      });
    })();
    /* ======= H√âROE / MOVIMIENTO ======= */
    (function(){
      const hero = { el:null, x:0, y:0, w:110, h:110, speed:4, dir:'up' };
      const keys = { up:false, down:false, left:false, right:false };
      let running = false, canMove = false;
      const bounds = {
        top: parseInt(getComputedStyle(document.documentElement).getPropertyValue('--wallTop')) || 60,
        left: parseInt(getComputedStyle(document.documentElement).getPropertyValue('--wallX')) || 40,
        right: parseInt(getComputedStyle(document.documentElement).getPropertyValue('--wallX')) || 40,
        bottom: parseInt(getComputedStyle(document.documentElement).getPropertyValue('--wallBottom')) || 85
      };
      const doorOutsideFactor = 0.25;
      // Preload images
      [
        'https://placehold.co/110x110/FFD700/000000/png?text=Up',
        'https://placehold.co/110x110/FFD700/000000/png?text=Down',
        'https://placehold.co/110x110/FFD700/000000/png?text=Left',
        'https://placehold.co/110x110/FFD700/000000/png?text=Right',
        'https://i.imgur.com/kx3psEN.png',
        'https://i.imgur.com/ViqP2fB.png',
        'https://i.imgur.com/FIrcwmM.png',
        'https://i.imgur.com/oEs8TdL.png',
        'https://i.imgur.com/hGY3pGX.png'
      ].forEach(src=>{
        const img = new Image();
        img.src = src;
        img.onerror = () => console.error(`Failed to load image: ${src}`);
      });
      function start(){
        const pf = document.getElementById('f7');
        hero.el = document.getElementById('hero');
        const W = pf.clientWidth, H = pf.clientHeight;
        hero.w = window.innerWidth <= 560 ? 80 : 110;
        hero.h = window.innerWidth <= 560 ? 80 : 110;
        hero.x = W/2;
        hero.y = H - hero.h*(0.5 - doorOutsideFactor);
        place();
        if(!running){ running = true; requestAnimationFrame(loop); }
      }
      function place(){
        hero.el.style.width = hero.w + 'px';
        hero.el.style.height = hero.h + 'px';
        hero.el.style.left = hero.x + 'px';
        hero.el.style.top = hero.y + 'px';
      }
      function loop(){
        if(!running) return;
        const pf = document.getElementById('f7');
        const W = pf.clientWidth, H = pf.clientHeight;
        let vx = 0, vy = 0;
        if(canMove){
          if(keys.left) vx -= hero.speed;
          if(keys.right) vx += hero.speed;
          if(keys.up) vy -= hero.speed;
          if(keys.down) vy += hero.speed;
          if(vx && vy){ vx*=0.7071; vy*=0.7071; }
        }
        hero.x += vx; hero.y += vy;
        if(canMove){
          const minX = bounds.left + hero.w/2;
          const minY = bounds.top + hero.h/2;
          const maxX = W - (bounds.right + hero.w/2);
          const maxY = H - (bounds.bottom + hero.h/2);
          hero.x = Math.max(minX, Math.min(maxX, hero.x));
          hero.y = Math.max(minY, Math.min(maxY, hero.y));
        }
        if(canMove){
          if(vx>0) setDir('right');
          else if(vx<0) setDir('left');
          else if(vy>0) setDir('down');
          else if(vy<0) setDir('up');
        }
        place();
        hintNearChests();
        requestAnimationFrame(loop);
      }
      function setDir(d){
        if(hero.dir === d) return;
        hero.el.classList.remove('dir-up','dir-down','dir-left','dir-right');
        hero.el.classList.add('dir-'+d);
        hero.dir = d;
      }
      // Keyboard controls
      function key(e, down){
        const k = e.key.toLowerCase();
        if(['arrowup','w'].includes(k)){ keys.up = down; e.preventDefault(); }
        if(['arrowdown','s'].includes(k)){ keys.down = down; e.preventDefault(); }
        if(['arrowleft','a'].includes(k)){ keys.left = down; e.preventDefault(); }
        if(['arrowright','d'].includes(k)){ keys.right = down; e.preventDefault(); }
      }
      window.addEventListener('keydown', e=>key(e,true), {passive:false});
      window.addEventListener('keyup', e=>key(e,false), {passive:false});
      // Touch controls
      let touchStartX = 0, touchStartY = 0;
      const touchThreshold = 20;
      function handleTouchStart(e){
        if(!canMove) return;
        const touch = e.touches[0];
        touchStartX = touch.clientX;
        touchStartY = touch.clientY;
      }
      function handleTouchMove(e){
        if(!canMove) return;
        e.preventDefault();
        const touch = e.touches[0];
        const dx = touch.clientX - touchStartX;
        const dy = touch.clientY - touchStartY;
        keys.left = dx < -touchThreshold;
        keys.right = dx > touchThreshold;
        keys.up = dy < -touchThreshold;
        keys.down = dy > touchThreshold;
        touchStartX = touch.clientX;
        touchStartY = touch.clientY;
      }
      function handleTouchEnd(){
        keys.left = keys.right = keys.up = keys.down = false;
      }
      document.getElementById('f7').addEventListener('touchstart', handleTouchStart, {passive:false});
      document.getElementById('f7').addEventListener('touchmove', handleTouchMove, {passive:false});
      document.getElementById('f7').addEventListener('touchend', handleTouchEnd, {passive:false});
      // Hint cerca de cofres
      function hintNearChests(){
        if(!canMove){ hide('#wizardHint'); return; }
        const heroRect = hero.el.getBoundingClientRect();
        const chSel = ['.ca1','.ca2','.ca3'];
        let near = false;
        chSel.forEach(sel=>{
          const el = document.querySelector(sel);
          if(!el) return;
          const r = el.getBoundingClientRect();
          const cx = r.left + r.width/2, cy = r.top + r.height/2;
          const hx = heroRect.left + heroRect.width/2, hy = heroRect.top + heroRect.height/2;
          const dist = Math.hypot(cx-hx, cy-hy);
          if(dist < 140) near = true;
        });
        if(near) showFlex('#wizardHint'); else hide('#wizardHint');
      }
      window.__heroCtrl = {
        start,
        enable:()=>{ canMove=true; },
        disable:()=>{ canMove=false; }
      };
    })();
    /* ======= FLUJO / DI√ÅLOGOS ======= */
    $(function(){
      showFlex('#f1');
      $('.q1-no').on('click', function(){ hide('.frame'); showFlex('#close1'); });
      $('.q1-si').on('click', function(){ hide('#f1'); showFlex('#f2new'); });
      $('.q2-no').on('click', function(){ hide('.frame'); showFlex('#close2'); });
      $('.q2-seguir').on('click', function(){ hide('#f2new'); showFlex('#f3new'); });
      $('.q3-beso, .q3-cocacho').on('click', function(){ hide('#f3new'); showFlex('#f4new'); });
      $('.q4-no').on('click', function(){ hide('#f4new'); showFlex('#f5new'); });
      $('.q4-seguir').on('click', function(){ hide('.frame'); showFlex('#f6'); });
      $('.afi').on('click', function(){
        hide('#f6'); showFlex('#f7'); showFlex('#f8');
        __heroCtrl.start();
        __heroCtrl.disable();
      });
      $('.salu').on('click', function(){ hide('#f8'); showFlex('#f9'); });
      $('.copy').on('click', function(){
        hide('#f9'); showFlex('#f10'); showFlex('#f11');
        __heroCtrl.enable();
      });
      $('.ca1').on('click', function(){ showFlex('#f12'); showBlock('#f13'); });
      $('.go').on('click', function(){ hide('#f13'); showBlock('#f14'); });
      $('.carta').on('click', function(){ hide('#f12'); });
      $('.ca3').on('click', function(){ showBlock('#f15'); showFlex('#f16'); });
      $('.anillo').on('click', function(){ hide('#f16'); showFlex('#f17'); });
      $('.marry').on('click', function(){ hide('#f15'); hide('#f17'); });
      $('.ca2').on('click', function(){ showBlock('#f18'); showFlex('#f19'); });
      $('.meme').on('click', function(){ hide('#f19'); showFlex('#f20'); });
      $('.meme2').on('click', function(){ hide('#f20'); showFlex('#f21'); });
      $('.yes').on('click', function(){ hide('#f21'); showFlex('#f22'); });
      $('.btn').attr('tabindex','0').attr('role','button').on('touchstart', function(e){
        e.preventDefault();
        $(this).click();
      });
      $(document).on('keydown', function(e){
        if(e.key === 'Enter' || e.key === ' '){
          const el = document.activeElement;
          if($(el).is('.btn')){ e.preventDefault(); $(el).click(); }
        }
      });
    });
  </script>
</body>
</html>
